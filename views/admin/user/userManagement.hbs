<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<body>
    <div class="container mt-5">
        <h2>User Management <small>Organic</small></h2>

        {{#if success}}
        <div class="alert alert-success">
            {{success}}
        </div>
        {{/if}}
        {{#if error}}
        <div class="alert alert-danger">
            {{error}}
        </div>
        {{/if}}

        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>User Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Active/Deactive</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each Users}}
                    <tr>
                        <td>{{this.userName}}</td>
                        <td>{{this.email}}</td>
                        <td>{{this.phoneNumber}}</td>
                        <td>
                            <span class="{{#if this.isActive}}text-success{{else}}text-danger{{/if}}">
                                {{#if this.isActive}}Active{{else}}Deactive{{/if}}
                            </span>
                        </td>
                        <td class="d-flex justify-content-start">
                            <button class="btn btn-sm {{#if this.isBlocked}}btn-danger{{else}}btn-success{{/if}} toggle-status" data-user-id="{{this._id}}">
                                <i class="bi {{#if this.isBlocked}}bi-person-lock{{else}}bi-person-check{{/if}}"></i>
                            </button>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
        <!-- Pagination Section -->
        <div class="pagination-container d-flex flex-row align-items-center justify-content-between mt-4">
            <div class="pagination-summary text-primary">
                Page {{ currentPage }} of {{ totalPages }}
            </div>
            <div class="pagination-links d-flex flex-row align-items-center justify-content-between gap-3">
                {{#if (gt currentPage 1)}}
                <a href="/admin/userManagement?page={{ subtract currentPage 1 }}" class="pagination-link text-primary">Previous</a>
                {{/if}}
                {{#if (lt currentPage totalPages)}}
                <a href="/admin/userManagement?page={{ add currentPage 1 }}" class="pagination-link text-primary">Next</a>
                {{/if}}
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function() {
        $('.toggle-status').click(function() {
            const userId = $(this).data('user-id');
            const $button = $(this);
            const isBlocked = $button.hasClass('btn-danger');

            Swal.fire({
                title: 'Are you sure?',
                text: `You are about to ${isBlocked ? 'unblock' : 'block'} this user.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: `Yes, ${isBlocked ? 'unblock' : 'block'} it!`,
                cancelButtonText: 'No, keep it'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: isBlocked ? '/admin/unblockUser' : '/admin/blockUser',
                        type: 'POST',
                        data: { userId: userId },
                        success: function(response) {
                            Swal.fire({
                                icon: 'success',
                                text: `User ${isBlocked ? 'unblocked' : 'blocked'} successfully.`
                            }).then(() => {
                                $button
                                    .toggleClass('btn-success btn-danger')
                                    .find('i')
                                    .toggleClass('bi-person-check bi-person-lock');
                                $button.closest('tr').find('span')
                                    .toggleClass('text-danger text-sucess')
                                    .text(isBlocked ? 'Active' : 'Deactive');
                            });
                        },
                        error: function(error) {
                            Swal.fire({
                                icon: 'error',
                                text: `Failed to ${isBlocked ? 'unblock' : 'block'} user.`
                            });
                        }
                    });
                }
            });
        });
    });
    </script>
    </body>

