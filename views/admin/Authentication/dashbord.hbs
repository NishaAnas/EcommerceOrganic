    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet" href="/stylesheets/dashboard.css">
    <body>
        <div class="container mt-4">
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4">
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-info">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Orders</p>
                                <h4 class="my-1 text-info" id="totalOrders">{{totalOrders}}</h4>
                                <p class="mb-0 font-13">{{totalOrdersChange}} from last day</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-scooter text-white ms-auto">
                                <i class="fa fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-danger">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Revenue</p>
                                <h4 class="my-1 text-danger" id="totalRevenue">{{totalRevenue}}</h4>
                                <p class="mb-0 font-13">{{totalRevenueChange}} from last day</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-bloody text-white ms-auto">
                                <i class="fa fa-inr"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-success">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Coupon Discount</p>
                                <h4 class="my-1 text-success" id="totalCouponDiscount">{{totalCouponDiscount}}</h4>
                                <p class="mb-0 font-13">{{totalCouponDiscountChange}} from last day</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto">
                                <i class="fa fa-gift"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-warning">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Customers</p>
                                <h4 class="my-1 text-warning" id="totalCustomers">{{totalCustomers}}</h4>
                                <p class="mb-0 font-13">+8.4% from last week</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-blooker text-white ms-auto">
                                <i class="fa fa-users"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="row">
    {{!-- Graph details --}}
        <div class="col-md-8">
            <div class="d-flex  align-items-center justify-content-end">
                <select class="graphSales" style="background-color: antiquewhite; border-radius: 4px;">
                <option selected disabled>Daily</option>
                <option value="Daily">Daily</option>
                <option value="Monthly">Monthly</option>
                <option value="Yearly">Yearly</option>
            </select>
                <button class="btn btn-success ms-2 graphChange">Apply</button>
            </div>
                <canvas class="myChart mt-4" width="400" height="200"></canvas>
        </div>

        {{!-- best Sellers table --}}
    <div class="col-md-4">
            <div class="table-responsive">
                <h3>Bestsellers</h3>
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th>Product Name</th>
                            <th>Orders Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Organic Apples</td>
                            <td>25</td>
                        </tr>
                        <tr>
                            <td>Fresh Avocados</td>
                            <td>20</td>
                        </tr>
                        <tr>
                            <td>Natural Almonds</td>
                            <td>18</td>
                        </tr>
                        <tr>
                            <td>Handmade Soap</td>
                            <td>15</td>
                        </tr>
                        <tr>
                            <td>Pure Honey</td>
                            <td>12</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

                        
                    
</body>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
    const fetchAndDisplayData = (url, chartLabel) => {
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                let labels, revenue;

                if (chartLabel === 'Daily') {
                    labels = data.map(entry => {
                        const date = new Date(entry._id);
                        return `${date.getDate()} ${date.toLocaleString('default', { month: 'short' })}`;
                    });
                    revenue = data.map(entry => entry.totalRevenue);
                } else if (chartLabel === 'Monthly') {
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    revenue = data.map(entry => ({
                        month: entry._id - 1,
                        totalRevenue: entry.totalRevenue
                    })).reduce((acc, curr) => {
                        acc[curr.month] = curr.totalRevenue;
                        return acc;
                    }, new Array(12).fill(0));
                } else if (chartLabel === 'Yearly') {
                    labels = data.map(entry => entry._id);
                    revenue = data.map(entry => entry.totalRevenue);
                }

                const ctx = document.querySelector('.myChart').getContext('2d');
                const chartInstance = Chart.getChart(ctx);
                if (chartInstance) {
                    chartInstance.destroy();
                }

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${chartLabel} Revenue`,
                            data: revenue,
                            backgroundColor: 'rgba(16, 232, 163, 1)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(249, 221, 41, 0.6)'
                                },
                                ticks: {
                                    color: 'green'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(249, 221, 41, 0.6)'
                                },
                                ticks: {
                                    color: 'red'
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching or processing data:', error));
    };

    // Fetch and display default daily revenue chart on page load
    fetchAndDisplayData('/admin/Daily', 'Daily');

    // Event listener for the graph change button
    document.querySelector('.graphChange').addEventListener('click', () => {
        const select = document.querySelector('.graphSales');
        const selectedValue = select.value;

        if (selectedValue === 'Daily') {
            fetchAndDisplayData('/admin/Daily', 'Daily');
        } else if (selectedValue === 'Monthly') {
            fetchAndDisplayData('/admin/Monthly', 'Monthly');
        } else if (selectedValue === 'Yearly') {
            fetchAndDisplayData('/admin/Yearly', 'Yearly');
        }
    });
});

    </script>
