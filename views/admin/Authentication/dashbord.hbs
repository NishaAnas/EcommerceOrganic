<style>
   body{
margin-top:20px;
background-color: #f7f7ff;
}
.radius-10 {
    border-radius: 10px !important;
}

.border-info {
    border-left: 5px solid  #0dcaf0 !important;
}
.border-danger {
    border-left: 5px solid  #fd3550 !important;
}
.border-success {
    border-left: 5px solid  #15ca20 !important;
}
.border-warning {
    border-left: 5px solid  #ffc107 !important;
}
.dropdown {
	position: relative;
	padding: 5px 10px;
	background-color: #fff;
	-webkit-box-shadow: 0 -2px 24px rgba(160, 163, 189, .25);
	box-shadow: 0 -2px 24px rgba(160, 163, 189, .25);
	border-radius: 4px;
	-webkit-transition: .3s all;
	-o-transition: .3s all;
	transition: .3s all;
	z-index: 3
}
.dropdown::before {
	content: '';
	position: relative;
	border-style: solid;
	border-width: 0 15px 15px;
	border-color: transparent transparent #fff
}
.drop li:last-child a {
	border-width: 0
}

.drop a {
	display: inline-block;
	width: 100%;
	font-weight: 500;
	font-size: 14px;
	line-height: 2.43;
	color: #767676;
	border-bottom: 1px solid #eee;
	text-align: left
}
.main-nav .nav-user-wrapper .users-item-dropdown1 {
	width: 171px;
	right: 0
}

.main-nav .nav-user-img,
.main-nav .nav-user-wrapper .users-item-dropdown1 a {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
	-webkit-box-align: center;
	-ms-flex-align: center;
	align-items: center
}
.nav-user-img {
    position: relative; /* Set position relative for the container */
}

/* Style for the dropdown button */
.nav-user-btn {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
}

/* Style for the profile image */
.nav-user-img img {
    width: 30px; /* Adjust size as needed */
    height: 30px; /* Adjust size as needed */
    border-radius: 50%; /* Ensure the image is round */
}

/* Position the dot */
.online-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: green;
    border-radius: 50%;
    top: 5px; /* Adjust as needed */
    right: 5px; /* Adjust as needed */
}

/* Style for the dropdown menu */
.nav-user-dropdown1 {
    display: none;
    position: absolute;
    background-color: #fff;
    min-width: 120px; /* Adjust as needed */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    z-index: 2;
}

.drop a:hover {
	color: #6A9739
}
.card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 0px solid rgba(0, 0, 0, 0);
    border-radius: .25rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 6px 0 rgb(218 218 253 / 65%), 0 2px 6px 0 rgb(206 206 238 / 54%);
}

.bg-gradient-scooter {
    background: #17ead9;
    background: -webkit-linear-gradient( 
45deg
 , #17ead9, #6078ea)!important;
    background: linear-gradient( 
45deg
 , #17ead9, #6078ea)!important;
}
.widgets-icons-2 {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #ededed;
    font-size: 27px;
    border-radius: 10px;
}
.rounded-circle {
    border-radius: 50%!important;
}
.text-white {
    color: #fff!important;
}
.ms-auto {
    margin-left: auto!important;
}
.bg-gradient-bloody {
    background: #f54ea2;
    background: -webkit-linear-gradient( 
45deg
 , #f54ea2, #ff7676)!important;
    background: linear-gradient( 
45deg
 , #f54ea2, #ff7676)!important;
}

.bg-gradient-ohhappiness {
    background: #00b09b;
    background: -webkit-linear-gradient( 
45deg
 , #00b09b, #96c93d)!important;
    background: linear-gradient( 
45deg
 , #00b09b, #96c93d)!important;
}

.bg-gradient-blooker {
    background: #ffdf40;
    background: -webkit-linear-gradient( 
45deg
 , #ffdf40, #ff8359)!important;
    background: linear-gradient( 
45deg
 , #ffdf40, #ff8359)!important;
}
</style>


    <body>
        <div class="container mt-4">
        <div class="row justify-content-end mb-3">
            <div class="col-auto">
                <div class="dropdown d-flex flex-row justify-content-end mb-3">
                    <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Sales Report
                    </button>
                    <div class="dropdown-menu" aria-labelledby="salesReportBtn">
                        <a class="dropdown-item" href="#" data-report-type="custom">Custom</a>
                        <a class="dropdown-item" href="#" data-report-type="daily">Daily</a>
                        <a class="dropdown-item" href="#" data-report-type="weekly">Weekly</a>
                        <a class="dropdown-item" href="#" data-report-type="monthly">Monthly</a>
                        <a class="dropdown-item" href="#" data-report-type="yearly">Yearly</a>
                    </div>
                </div>
                <div id="selectedReport" class="mt-2"></div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4">
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-info">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Orders</p>
                                <h4 class="my-1 text-info" id="totalOrders">{{totalOrders}}</h4>
                                <p class="mb-0 font-13">+2.5% from last week</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-scooter text-white ms-auto">
                                <i class="fa fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-danger">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Revenue</p>
                                <h4 class="my-1 text-danger" id="totalRevenue">{{totalRevenue}}</h4>
                                <p class="mb-0 font-13">+5.4% from last week</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-bloody text-white ms-auto">
                                <i class="fa fa-inr"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-success">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Coupon Discount</p>
                                <h4 class="my-1 text-success" id="totalCouponDiscount">{{totalCouponDiscount}}</h4>
                                <p class="mb-0 font-13">-4.5% from last week</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto">
                                <i class="fa fa-gift"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card radius-10 border-start border-0 border-3 border-warning">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <p class="mb-0 text-secondary">Total Customers</p>
                                <h4 class="my-1 text-warning" id="totalCustomers">{{totalCustomers}}</h4>
                                <p class="mb-0 font-13">+8.4% from last week</p>
                            </div>
                            <div class="widgets-icons-2 rounded-circle bg-gradient-blooker text-white ms-auto">
                                <i class="fa fa-users"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <button class="btn btn-small btn-success m-3  download-pdf" type="button">
                Download as PDF
            </button>
            <button class="btn btn-small btn-success m-3  download-pdf" type="button">
                Download as Excel
            </button>

    </div>

    <div class="modal fade" id="customDateModal" tabindex="-1" aria-labelledby="customDateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customDateModalLabel">Select Date Range</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="customDateForm">
                        <div class="form-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" class="form-control" id="startDate" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date</label>
                            <input type="date" class="form-control" id="endDate" name="endDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Generate Report</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            let currentReportType = 'daily';
            let startDate = '';
            let endDate = '';
            let ordersData = [];

            // Handle dropdown selection
            $('.dropdown-item').click(function(event) {
                event.preventDefault();
                var reportType = $(this).data('report-type');
                if (reportType === 'custom') {
                    $('#customDateModal').modal('show');
                } else {
                    currentReportType = reportType;
                    $('#selectedReport').text('Selected Report: ' + reportType.charAt(0).toUpperCase() + reportType.slice(1));
                    fetchReport(reportType);
                }
            });

            // Handle custom date range form submission
            $('#customDateForm').submit(function(event) {
                event.preventDefault();
                startDate = $('#startDate').val();
                endDate = $('#endDate').val();
                currentReportType = 'custom';
                $('#selectedReport').text(`Selected Report: Custom (${startDate} to ${endDate})`);
                fetchReport('custom', { startDate: startDate, endDate: endDate });
                $('#customDateModal').modal('hide');
            });

            // Download report as PDF
            $('.download-pdf').on('click', function(event) {
                event.preventDefault();
                const format = 'pdf';
                downloadReport(format,currentReportType,startDate, endDate);
            });

            // Download report as Excel
            $('.download-excel').on('click', function(event) {
                event.preventDefault();
                const format = 'excel';
                downloadReport(format,currentReportType,startDate, endDate);
            });


            // Fetch report data
            function fetchReport(reportType, dates = {}) {
                $.ajax({
                    url: '/admin/getReport',
                    type: 'POST',
                    data: JSON.stringify({ reportType: reportType, dates: dates }),
                    contentType: 'application/json',
                    success: function(response) {
                        $('#totalOrders').text(response.totalOrders);
                        $('#totalRevenue').text(response.totalRevenue);
                        $('#totalCouponDiscount').text(response.totalCouponDiscount);
                        $('#totalCustomers').text(response.totalCustomers);
                        ordersData = response.orders; 
                        Swal.fire({
                        icon: 'success',
                        title: 'Report Fetched',
                        text: 'Sales report data has been updated.'
                    });
                    },
                    error: function(error) {
                        console.error('Error fetching report:', error);
                        Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'There was an error fetching the sales report.'
                    });
                    }
                });
            }

            function downloadReport(format, type, startDate, endDate) {
                const requestData = {
                                format,
                                type,
                                startDate,
                                endDate,
                            };

                            if (orders.length > 0) {
                                requestData.orders = orders;
                            }
            $.ajax({
                url: '/admin/downloadReport',
                type: 'POST',  
                contentType: 'application/json',  
                data: JSON.stringify(orders),
                success: function() {
                    Swal.fire({
                        icon: 'success',
                        title: 'Download Successful',
                        text: `The ${type} report in ${format.toUpperCase()} format has been downloaded.`,
                    });
                },
                error: function(error) {
                    console.error('Error downloading report:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Download Failed',
                        text: `There was an error downloading the ${type} report in ${format.toUpperCase()} format.`,
                    });
                }
            });
        }
        });
    </script>
</body>